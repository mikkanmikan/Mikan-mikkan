<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>英単語学習アプリ + Weibullモデル</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body { font-family: sans-serif; margin: 20px; }
  .screen { display: none; }
  #startScreen, #quizScreen, #summaryScreen { padding: 20px; border: 1px solid #ccc; border-radius: 8px; }
  button { margin-top: 10px; padding: 5px 10px; cursor: pointer; }
  #quizScreen input { padding: 5px; width: 200px; }
  table { border-collapse: collapse; margin-top: 10px; }
  th, td { border: 1px solid #ccc; padding: 5px 10px; }
</style>
</head>
<body>

<!-- スタート画面 -->
<div id="startScreen" class="screen" style="display:block;">
  <h2>ここをクリックしてスタート</h2>
  <button id="startButton">スタート</button>
</div>

<!-- 問題画面 -->
<div id="quizScreen" class="screen">
  <h2 id="quizWord">英単語</h2>
  <input type="text" id="userAnswer" placeholder="日本語を入力">
  <button id="submitAnswer">送信</button>
  <p id="feedback"></p>
  <button id="nextQuestion" style="display:none;">次へ</button>
</div>

<!-- まとめ画面 -->
<div id="summaryScreen" class="screen">
  <h2>まとめ</h2>
  <p id="score"></p>
  <p id="nextDate"></p>
  <table id="resultTable">
    <thead>
      <tr>
        <th>英単語</th>
        <th>あなたの答え</th>
        <th>正答</th>
        <th>正誤</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <canvas id="forgetChart" width="400" height="200"></canvas>
</div>

<script>
const alpha = 1.0;
const beta = 2.0;
const totalQuestions = 5;

// 難しい英単語リスト（必要に応じて増やせます）
const wordList = [
  {eng:"obfuscate", jp:"わかりにくくする"},
  {eng:"pulchritude", jp:"美しさ"},
  {eng:"abrogate", jp:"廃止する"},
  {eng:"lachrymose", jp:"涙もろい"},
  {eng:"recalcitrant", jp:"反抗的な"},
  {eng:"sesquipedalian", jp:"長ったらしい言葉を使う"},
  {eng:"antediluvian", jp:"非常に古い"},
  {eng:"effulgent", jp:"輝かしい"},
  {eng:"insouciant", jp:"無頓着な"},
  {eng:"perfidious", jp:"裏切りの"},
  {eng:"ephemeral", jp:"儚い"},
  {eng:"mellifluous", jp:"甘美な"},
  {eng:"pulverize", jp:"粉砕する"},
  {eng:"obstreperous", jp:"騒々しい"},
  {eng:"vicissitude", jp:"変遷"},
  {eng:"apocryphal", jp:"偽の"},
  {eng:"cogent", jp:"説得力のある"},
  {eng:"demagogue", jp:"扇動政治家"},
  {eng:"exacerbate", jp:"悪化させる"},
  {eng:"quixotic", jp:"非現実的な"}
];

// 状態管理
let quizWords = [];
let current = 0;
let answers = [];

// スタート
function startQuiz() {
  document.getElementById('startScreen').style.display = 'none';
  document.getElementById('quizScreen').style.display = 'block';

  // ランダムに5問抽出（重複なし）
  quizWords = [];
  const tempList = [...wordList];
  for(let i=0; i<totalQuestions; i++){
    const idx = Math.floor(Math.random() * tempList.length);
    quizWords.push(tempList.splice(idx,1)[0]);
  }

  current = 0;
  answers = [];
  showQuestion();
}

// 問題表示
function showQuestion() {
  const q = quizWords[current];
  document.getElementById('quizWord').textContent = q.eng;
  document.getElementById('userAnswer').value = '';
  document.getElementById('feedback').textContent = '';
  document.getElementById('nextQuestion').style.display = 'none';
  document.getElementById('userAnswer').focus();
}

// 送信判定
function submitAnswer() {
  const userAns = document.getElementById('userAnswer').value.trim();
  const correctAns = quizWords[current].jp;
  const isCorrect = (userAns === correctAns);
  document.getElementById('feedback').textContent = 
    isCorrect ? `正解！答え: ${correctAns}` : `不正解。答え: ${correctAns}`;
  answers.push({word:quizWords[current].eng, user:userAns, correct:correctAns, correctFlag:isCorrect});
  document.getElementById('nextQuestion').style.display = 'inline-block';
}

// 次へ
function nextQuestion() {
  current++;
  if(current < totalQuestions){
    showQuestion();
  } else {
    showSummary();
  }
}

// まとめ画面表示
function showSummary() {
  document.getElementById('quizScreen').style.display = 'none';
  document.getElementById('summaryScreen').style.display = 'block';

  const correctCount = answers.filter(a=>a.correctFlag).length;
  document.getElementById('score').textContent = `正答数: ${correctCount}/${totalQuestions}`;

  // 次回学習日計算（記憶保持率 0.9 を下回るタイミング）
  const threshold = 0.9;
  const tNext = Math.round(beta * Math.pow(-Math.log(threshold), 1/alpha));
  document.getElementById('nextDate').textContent = `次回学習日: ${tNext}日後`;

  // 表作成
  const tbody = document.querySelector('#resultTable tbody');
  tbody.innerHTML = '';
  answers.forEach(a=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${a.word}</td><td>${a.user}</td><td>${a.correct}</td><td>${a.correctFlag ? '正解' : '不正解'}</td>`;
    tbody.appendChild(tr);
  });

  // 忘却曲線描画
  const ctx = document.getElementById('forgetChart').getContext('2d');
  const labels = [];
  const data = [];
  for(let t=0; t<=tNext*2; t++){
    labels.push(t);
    data.push(Math.exp(-Math.pow(t/beta, alpha)));
  }
  new Chart(ctx, {
    type: 'line',
    data: {
      labels: labels,
      datasets: [{
        label: '忘却曲線 R(t)',
        data: data,
        borderColor: 'blue',
        fill: false
      }]
    },
    options: {
      responsive: true,
      scales: {
        x: { title: { display:true, text:'日数' } },
        y: { title: { display:true, text:'記憶保持率' }, min:0, max:1 }
      }
    }
  });
}

// イベント紐付け
document.getElementById('startButton').addEventListener('click', startQuiz);
document.getElementById('startScreen').addEventListener('click', startQuiz);
document.getElementById('submitAnswer').addEventListener('click', submitAnswer);
document.getElementById('nextQuestion').addEventListener('click', nextQuestion);

// Enterキーでも送信可能
document.getElementById('userAnswer').addEventListener('keydown', e=>{
  if(e.key==='Enter') submitAnswer();
});
</script>

</body>
</html>
