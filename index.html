<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>英単語学習アプリ + Weibullモデル</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { font-family: sans-serif; margin: 20px; }
button { margin-top: 10px; padding: 5px 10px; }
input { margin-top: 5px; padding: 3px; }
#quiz, #result, #summary, #chartContainer { margin-top: 20px; }
table { border-collapse: collapse; width: 80%; }
th, td { border: 1px solid #333; padding: 5px; text-align: center; }
</style>
</head>
<body>

<h1>英単語学習アプリ</h1>

<div id="startScreen">
  <button id="startBtn">スタート</button>
</div>

<div id="quiz"></div>
<div id="result"></div>
<div id="summary"></div>
<div id="chartContainer">
  <canvas id="forgetChart"></canvas>
</div>

<script>
// 50題の難単語リスト
const words = [
{eng:"ephemeral", jap:"はかない"}, {eng:"obfuscate", jap:"わかりにくくする"}, {eng:"quintessential", jap:"典型的な"},
{eng:"juxtaposition", jap:"並置"}, {eng:"ubiquitous", jap:"偏在する"}, {eng:"serendipity", jap:"偶然の幸運"},
{eng:"cogent", jap:"説得力のある"}, {eng:"antediluvian", jap:"太古の"}, {eng:"magnanimous", jap:"寛大な"},
{eng:"perfunctory", jap:"おざなりの"}, {eng:"obsequious", jap:"へつらいの"}, {eng:"esoteric", jap:"難解な"},
{eng:"loquacious", jap:"おしゃべりな"}, {eng:"epistolary", jap:"書簡体の"}, {eng:"callipygian", jap:"美尻の"},
{eng:"lachrymose", jap:"涙もろい"}, {eng:"pulchritude", jap:"美しさ"}, {eng:"sycophant", jap:"おべっか使い"},
{eng:"vituperate", jap:"非難する"}, {eng:"inchoate", jap:"未発達の"}, {eng:"pugnacious", jap:"好戦的な"},
{eng:"recalcitrant", jap:"反抗的な"}, {eng:"sagacious", jap:"賢明な"}, {eng:"tenebrous", jap:"暗い"},
{eng:"taciturn", jap:"無口な"}, {eng:"vociferous", jap:"声高な"}, {eng:"xenophobic", jap:"外国人嫌いの"}, 
{eng:"zephyr", jap:"そよ風"}, {eng:"abstruse", jap:"難解な"}, {eng:"blandishment", jap:"お世辞"}, 
{eng:"cacophony", jap:"不協和音"}, {eng:"diaphanous", jap:"透ける"}, {eng:"euphemism", jap:"婉曲表現"},
{eng:"fastidious", jap:"気難しい"}, {eng:"grandiloquent", jap:"大げさな"}, {eng:"heterogeneous", jap:"異種の"},
{eng:"ignominious", jap:"不名誉な"}, {eng:"juxtapose", jap:"並置する"}, {eng:"kaleidoscopic", jap:"万華鏡のような"},
{eng:"munificent", jap:"気前の良い"}, {eng:"nefarious", jap:"極悪な"}, {eng:"obstreperous", jap:"騒々しい"},
{eng:"parsimonious", jap:"けちな"}, {eng:"quixotic", jap:"非現実的な"}, {eng:"soporific", jap:"催眠性の"},
{eng:"tacit", jap:"暗黙の"}, {eng:"umbrageous", jap:"日陰の"}, {eng:"vicarious", jap:"代理の"}
];

// ワイブルモデル標準値
const alpha = 1.0;
const beta = 2.0;

let quizWords = [];
let current = 0;
let answers = [];

// ランダムに5問取得（重複なし）
function getRandomWords(n) {
    let shuffled = [...words].sort(() => 0.5 - Math.random());
    return shuffled.slice(0, n);
}

// 1問表示
function showQuestion() {
    if(current >= quizWords.length){
        showSummary();
        return;
    }
    const q = quizWords[current];
    document.getElementById("quiz").innerHTML = `
        <div>問題 ${current+1}: ${q.eng}</div>
        <input type="text" id="answer" placeholder="日本語を入力">
        <button id="submitBtn">送信</button>
    `;
    document.getElementById("submitBtn").addEventListener("click", checkAnswer);
}

// 回答チェック
function checkAnswer() {
    const userAns = document.getElementById("answer").value.trim();
    const correctAns = quizWords[current].jap;
    const resDiv = document.getElementById("result");
    let correct = userAns === correctAns;
    answers.push({eng: quizWords[current].eng, correctAns: correctAns, userAns: userAns, correct: correct});
    resDiv.innerHTML = correct ? `正解！答え: ${correctAns}` : `不正解。答え: ${correctAns}`;
    document.getElementById("quiz").innerHTML = `<button id="nextBtn">次へ</button>`;
    document.getElementById("nextBtn").addEventListener("click", nextQuestion);
}

// 次の問題へ
function nextQuestion() {
    current++;
    document.getElementById("result").innerHTML = "";
    showQuestion();
}

// スタート
function startQuiz() {
    document.getElementById("startScreen").style.display = "none";
    quizWords = getRandomWords(5);
    current = 0;
    answers = [];
    showQuestion();
}

// まとめ表示
function showSummary() {
    document.getElementById("quiz").innerHTML = "";
    const totalCorrect = answers.filter(a=>a.correct).length;
    const Rstar = totalCorrect/answers.length;
    const tNext = beta * Math.pow(-Math.log(Rstar), 1/alpha);

    let html = `<h2>結果まとめ</h2>
    <table>
        <tr><th>問題</th><th>あなたの答え</th><th>正答</th><th>正誤</th></tr>`;
    answers.forEach(a => {
        html += `<tr>
            <td>${a.eng}</td>
            <td>${a.userAns}</td>
            <td>${a.correctAns}</td>
            <td>${a.correct ? "〇" : "×"}</td>
        </tr>`;
    });
    html += `</table>`;
    html += `<p>正答数: ${totalCorrect} / ${answers.length}</p>`;
    html += `<p>次回学習日: ${tNext.toFixed(2)} 日後</p>`;
    document.getElementById("summary").innerHTML = html;

    drawChart();
}

// 忘却曲線描画
function drawChart() {
    const ctx = document.getElementById('forgetChart').getContext('2d');
    const tVals = Array.from({length: 50}, (_, i) => i*0.1);
    const Rvals = tVals.map(t => Math.exp(-(t/beta)**alpha));
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: tVals,
            datasets: [{
                label: '忘却曲線',
                data: Rvals,
                borderColor: 'blue',
                fill: false
            }]
        },
        options: {
            responsive: true,
            scales: {
                x: { title: { display: true, text: '経過時間 t' } },
                y: { title: { display: true, text: '記憶保持率 R(t)' }, min:0, max:1 }
            }
        }
    });
}

// ページ読み込み後にスタートボタンにイベント追加
document.addEventListener("DOMContentLoaded", () => {
    document.getElementById("startBtn").addEventListener("click", startQuiz);
});
</script>

</body>
</html>
